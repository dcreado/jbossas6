<!-- An ant project fragement imported into the main testsuite build that
defines the jboss server config and start/stop targets.
$Id: server-config.xml 111410 2011-05-20 08:04:26Z beve $
-->
<project name="server-config" default="help"
         xmlns:server="http://jboss.org/ns/test/ant/server">

   <!-- Use the ${/} platform seperator in jboss.dist, jboss.test.deploy.dir as
      this is used in the security policy file property references and needs to
      be valid for the platform.
   -->
   <property name="jboss.dist"
      value="${project.root}${/}build${/}target${/}jboss-${version}"/>
   <property name="jboss.test.deploy.dir"
      value="${project.root}${/}testsuite${/}output${/}lib"/>
   <!-- Override for non-Sun compatible JDK layouts -->
   <property name="javac.jar"
      value="${env.JAVA_HOME}/lib/tools.jar"/>
   <!--Default java executable for starting server -->
   <property name="java.exec"
      value="${env.JAVA_HOME}/bin/java"/>
   <!-- Override with the jpda settings for debugging start-jboss. An example
   for connecting with a debugger via the socket protocol:
   -Xdebug -Xrunjdwp:transport=dt_socket,address=8787,server=y,suspend=y

   An example of running with the
   -Xrunyjpagent

   <property name="jpda.cmdline" value="-Xdebug -Xrunjdwp:transport=dt_socket,address=8787,server=y,suspend=y" />
   -->
   <property name="jpda.cmdline" value="" />

   <!-- Override with the settings for running JBoss Profiler. A minimal
        example would be:
        
   -agentlib:jbossAgent
   
        For a 64 bit JVM this might be:
        
   -agentlib:jbossAgent -d64
   -->        
   <property name="jboss.profiler.cmdline" value="" />

   <path id="jboss.client.classpath">
      <fileset dir="${jboss.dist}/client"/>
   </path>

   <path id="jboss.boot.classpath">
      <pathelement location="${jboss.dist}/bin/run.jar"/>
      <pathelement location="${javac.jar}"/>
   </path>

   <!-- Set a extension property -bat for win32, sh
   otherwise
   -->
   <condition property="exten" value="bat">
      <os family="windows"/>
   </condition>
   <condition property="exten" value="sh">
      <not>
         <os family="windows"/>
      </not>
   </condition>

   <condition property="separator" value=";">
      <os family="windows"/>
   </condition>
   <condition property="separator" value=":">
      <not>
         <os family="windows"/>
      </not>
   </condition>

   <!-- TTL for multicast packets. Use jbosstest namespace
	    so it gets passed in to test client as well -->
   <property name="jbosstest.udp.ip_ttl" value="0"/>

  <target name="server-config" unless="server-config.target.complete">
    <path id="server.taskdef.classpath">
      <fileset refid="org.jboss.test:jboss-test:jar"/>
      <fileset refid="org.jboss.jbossas:jboss-server-manager:jar"/>
      <path refid="jboss.client.classpath"/>
    </path>
    
    <taskdef name="config" classname="org.jboss.ant.taskdefs.server.ConfigManagerTask"
            uri="http://jboss.org/ns/test/ant/server" loaderref="server.loader">
      <classpath refid="server.taskdef.classpath"/>
    </taskdef>
    <taskdef name="start" classname="org.jboss.ant.taskdefs.server.StartServerTask"
            uri="http://jboss.org/ns/test/ant/server" loaderref="server.loader">
      <classpath refid="server.taskdef.classpath"/>
    </taskdef>
    <taskdef name="stop" classname="org.jboss.ant.taskdefs.server.StopServerTask"
            uri="http://jboss.org/ns/test/ant/server" loaderref="server.loader">
      <classpath refid="server.taskdef.classpath"/>
    </taskdef>

    <server:config javaHome="${env.JAVA_HOME}" jbossHome="${jboss.dist}"
                  udpGroup="${udpGroup}">
      <server name="all" host="${node0}">
<!--
         <jvmarg value="-agentlib:yjpagent" />
         <jvmarg value="-Xrunyjpagent:sessionname=JBoss" />
-->
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />
<!--
         <jvmarg value="-Dcom.sun.management.jmxremote" />
         <jvmarg value="-XX:MaxPermSize=512m" />
         <jvmarg value="-Xmx512m" />
-->
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />      	
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
      	 <!-- JBAS-8540 -->
         <sysproperty key="naming.autodiscovery.mcast_addr" value="${jbosstest.naming.autodiscovery.mcast_addr}"/>
      </server>
<!--  Configured for tests-secured, full run.conf JAVA_OPTS are not needed
-->
      <server name="production" host="${node0}">
        <jvmarg value="-Xms256m" />
         <jvmarg value="-Xmx768m" />
         <jvmarg value="-XX:MaxPermSize=256m" />
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
         <sysproperty key="naming.autodiscovery.mcast_addr" value="${jbosstest.naming.autodiscovery.mcast_addr}"/>
      </server>
      <server name="generic" config="${generic.config}" host="${node0}" >
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
      </server>
      <server name="securitymgr" config="secmgr" host="${node0}">
         <jvmarg value="${jpda.cmdline}" />
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <jvmarg value="-Djboss.home.dir=${jboss.dist}" />
         <jvmarg value="-Djboss.server.home.dir=${jboss.dist}${/}server${/}secmgr" />
         <jvmarg value="-Djboss.test.deploy.dir=${jboss.test.deploy.dir}" />
      	 <jvmarg value="-Djava.security.manager"/>
         <jvmarg value="-Djava.security.policy=${build.resources}/securitymgr/server.policy"/>
	     <sysproperty key="java.protocol.handler.pkgs" value="org.jboss.handlers.stub"/>
         <jvmarg value="-Djava.security.debug=failure"/>
         <!-- jvmarg value="-Djboss.boot.server.log.level=TRACE"/ -->
         <!-- jvmarg value="-Djboss.boot.server.log.file.level=TRACE"/ -->
         <jvmarg value="-Djava.security.debug=failure"/>

         <!-- Replace for security manager debug verbose info
         <jvmarg value="-Djava.security.debug=access,failure,policy"/>
         -->
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
      </server>
      <server name="scoped-aop-jdk50" host="${node0}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />

         <jvmarg value="${jpda.cmdline}" />
         <jvmarg value="-javaagent:pluggable-instrumentor.jar"/>
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
      </server>
      <server name="scoped-aop-generated-advisor" host="${node0}">
         <jvmarg value="${jpda.cmdline}" />
         <jvmarg value="-javaagent:pluggable-instrumentor.jar"/>
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx256m" />
         <jvmarg value="-XX:MaxPermSize=512m" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <sysproperty key="jboss.aop.instrumentor" value="org.jboss.aop.instrument.GeneratedAdvisorInstrumentor"/>
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
      </server>
      <server name="jacc-securitymgr" host="${node0}" config="jacc-securitymgr">
         <jvmarg value="${jpda.cmdline}" />
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <jvmarg value="-XX:MaxPermSize=512m" />
         <jvmarg value="-Djboss.home.dir=${jboss.dist}" />
         <jvmarg value="-Djboss.server.home.dir=${jboss.dist}${/}server${/}jacc-securitymgr" />
         <jvmarg value="-Djboss.test.deploy.dir=${jboss.test.deploy.dir}" />
         <jvmarg value="-Djava.security.manager"/>
         <jvmarg value="-Djava.security.policy==${build.resources}/securitymgr/server.policy"/>
         <jvmarg value="-Djava.security.debug=access,failure"/>
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
	     <sysproperty key="java.protocol.handler.pkgs" value="org.jboss.handlers.stub"/>
      </server>
      <server name="jacc" host="${node0}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <jvmarg value="${jpda.cmdline}" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
      </server>
      <server name="jacc-security-allstarrole" host="${node0}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <jvmarg value="${jpda.cmdline}" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
      </server>
      <server name="jaspi" host="${node0}"/>
      <server name="tomcat-ssl" host="${node0}">
         <jvmarg value="${jpda.cmdline}" />
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
      </server>
      <server name="password-mask" host="${node0}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <jvmarg value="${jpda.cmdline}" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
      </server>
      <server name="jts" host="${node0}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
      </server>
      <server name="tomcat-sso" host="${node0}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx256m" />
         <jvmarg value="-XX:MaxPermSize=512m" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <jvmarg value="${jpda.cmdline}" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
      </server>
      <server name="opends" host="${node0}">
         <jvmarg value="${jpda.cmdline}" />
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx256m" />         
         <jvmarg value="-XX:MaxPermSize=512m" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
      </server>
      <server name="tomcat-webctx" host="${node0}">
         <jvmarg value="${jpda.cmdline}" />
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx256m" />
         <jvmarg value="-XX:MaxPermSize=512m" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
      </server>
      <server name="tomcat-federation" host="${node0}">
         <jvmarg value="${jpda.cmdline}" />
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx256m" />
         <jvmarg value="-XX:MaxPermSize=512m" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
      </server>
      <server name="node0" host="${node0}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=256m" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
         <sysproperty key="jgroups.bind_addr" value="${node0.jgroups.bind_addr}" />
      </server>
      <server name="node1" host="${node1}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=256m" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
         <sysproperty key="jgroups.bind_addr" value="${node1.jgroups.bind_addr}" />
      </server>
      <server name="clustered-ejb3-noBR-0" host="${node0}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=256m" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
         <sysproperty key="jgroups.bind_addr" value="${node0.jgroups.bind_addr}" />
      </server>
      <server name="clustered-ejb3-noBR-1" host="${node1}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=256m" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
         <sysproperty key="jgroups.bind_addr" value="${node1.jgroups.bind_addr}" />
      </server>
      <server name="cluster-udp-sync-0" host="${node0}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=256m" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
         <sysproperty key="jboss.multiplexer.stack" value="udp-sync" />
         <sysproperty key="jgroups.bind_addr" value="${node0.jgroups.bind_addr}" />
      </server>
      <server name="cluster-udp-sync-1" host="${node1}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
         <sysproperty key="jboss.multiplexer.stack" value="udp-sync" />
         <sysproperty key="jgroups.bind_addr" value="${node1.jgroups.bind_addr}" />
      </server>
      <server name="cluster-udp-0" host="${node0}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />    
         <jvmarg value="-XX:-UseGCOverheadLimit" />    
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
         <sysproperty key="node0.bind.address" value="${node0}" />
         <sysproperty key="node0.bind.address.url" value="${node0.url}" />
         <sysproperty key="jboss.partition.name" value="${partitionName}" />
         <sysproperty key="jgroups.bind_addr" value="${node0.jgroups.bind_addr}" />
      </server>
      <server name="cluster-udp-1" host="${node1}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />        
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
         <sysproperty key="node0.bind.address" value="${node0}" />
         <sysproperty key="node0.bind.address.url" value="${node0.url}" />
         <sysproperty key="jboss.partition.name" value="${partitionName}" />
         <sysproperty key="jgroups.bind_addr" value="${node1.jgroups.bind_addr}" />
      </server>
      <server name="cluster-udp-SYNC-0" host="${node0}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />    
         <jvmarg value="-XX:-UseGCOverheadLimit" />    
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
         <sysproperty key="jboss.multiplexer.stack" value="udp-sync" />
         <sysproperty key="jgroups.bind_addr" value="${node0.jgroups.bind_addr}" />
         <sysproperty key="node0.bind.address" value="${node0}" />
         <sysproperty key="node0.bind.address.url" value="${node0.url}" />
      </server>
      <server name="cluster-udp-SYNC-1" host="${node1}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />   
         <jvmarg value="-XX:-UseGCOverheadLimit" />     
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
         <sysproperty key="jboss.multiplexer.stack" value="udp-sync" />
         <sysproperty key="jgroups.bind_addr" value="${node1.jgroups.bind_addr}" />
         <sysproperty key="node0.bind.address" value="${node0}" />
         <sysproperty key="node0.bind.address.url" value="${node0.url}" />
      </server>
      <server name="cluster-udp-DIST-0" host="${node0}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" /> 
         <jvmarg value="-XX:-UseGCOverheadLimit" />       
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
        <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
        <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />      	
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
         <sysproperty key="jboss.multiplexer.stack" value="udp" />
         <sysproperty key="jgroups.bind_addr" value="${node0.jgroups.bind_addr}" />
         <sysproperty key="node0.bind.address" value="${node0}" />
         <sysproperty key="node0.bind.address.url" value="${node0.url}" />
      </server>
      <server name="cluster-udp-DIST-1" host="${node1}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />        
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
         <sysproperty key="jboss.multiplexer.stack" value="udp" />
         <sysproperty key="jgroups.bind_addr" value="${node1.jgroups.bind_addr}" />
         <sysproperty key="node0.bind.address" value="${node0}" />
         <sysproperty key="node0.bind.address.url" value="${node0.url}" />
      </server>
      <server name="cluster-tcp-0" host="${node0}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />        
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jboss.multiplexer.stack" value="tcp" />
         <sysproperty key="jgroups.tcpping.initial_hosts" value="${node0}[7600],${node1}[7600]"/>
         <sysproperty key="node0.bind.address" value="${node0}" />
         <sysproperty key="node0.bind.address.url" value="${node0.url}" />
         <sysproperty key="jboss.partition.name" value="${partitionName}" />
         <sysproperty key="jgroups.bind_addr" value="${node0.jgroups.bind_addr}" />
      </server>
      <server name="cluster-tcp-1" host="${node1}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />        
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jboss.multiplexer.stack" value="tcp" />
         <sysproperty key="jgroups.tcpping.initial_hosts" value="${node0}[7600],${node1}[7600]"/>
         <sysproperty key="node0.bind.address" value="${node0}" />
         <sysproperty key="node0.bind.address.url" value="${node0.url}" />
         <sysproperty key="jboss.partition.name" value="${partitionName}" />
         <sysproperty key="jgroups.bind_addr" value="${node1.jgroups.bind_addr}" />
      </server>
      <server name="cluster-tcp-sync-0" host="${node0}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />        
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jboss.multiplexer.stack" value="tcp-sync" />
         <sysproperty key="jgroups.tcpping.initial_hosts" value="${node0}[7650],${node1}[7650]"/>
         <sysproperty key="jgroups.bind_addr" value="${node0.jgroups.bind_addr}" />
      </server>
      <server name="cluster-tcp-sync-1" host="${node1}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />     
         <jvmarg value="-XX:-UseGCOverheadLimit" />   
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jboss.multiplexer.stack" value="tcp-sync" />
         <sysproperty key="jgroups.tcpping.initial_hosts" value="${node0}[7650],${node1}[7650]"/>
         <sysproperty key="jgroups.bind_addr" value="${node1.jgroups.bind_addr}" />
      </server>
      <server name="cluster-tcp-SYNC-0" host="${node0}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />        
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jboss.multiplexer.stack" value="tcp-sync" />
         <sysproperty key="jgroups.tcpping.initial_hosts" value="${node0}[7650],${node1}[7650]"/>
         <sysproperty key="jgroups.bind_addr" value="${node0.jgroups.bind_addr}" />
      </server>
      <server name="cluster-tcp-SYNC-1" host="${node1}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />       
         <jvmarg value="-XX:-UseGCOverheadLimit" /> 
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jboss.multiplexer.stack" value="tcp-sync" />
         <sysproperty key="jgroups.tcpping.initial_hosts" value="${node0}[7650],${node1}[7650]"/>
         <sysproperty key="jgroups.bind_addr" value="${node1.jgroups.bind_addr}" />
      </server>
      <server name="cluster-tcp-DIST-0" host="${node0}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />        
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />      	
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jboss.multiplexer.stack" value="tcp" />
         <sysproperty key="jgroups.tcpping.initial_hosts" value="${node0}[7650],${node1}[7650]"/>
         <sysproperty key="jgroups.bind_addr" value="${node0.jgroups.bind_addr}" />
      </server>
      <server name="cluster-tcp-DIST-1" host="${node1}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />        
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jboss.multiplexer.stack" value="tcp" />
         <sysproperty key="jgroups.tcpping.initial_hosts" value="${node0}[7650],${node1}[7650]"/>
         <sysproperty key="jgroups.bind_addr" value="${node1.jgroups.bind_addr}" />
      </server>
      <server name="tomcat-sso-cluster0" host="${node0}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />    
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />    
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
         <sysproperty key="jboss.multiplexer.stack" value="udp-sync" />
         <sysproperty key="jgroups.bind_addr" value="${node0.jgroups.bind_addr}" />
      </server>
      <server name="tomcat-sso-cluster1" host="${node1}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" /> 
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />       
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
         <sysproperty key="jboss.multiplexer.stack" value="udp-sync" />
         <sysproperty key="jgroups.bind_addr" value="${node1.jgroups.bind_addr}" />
      </server>
      <server name="binding-manager1" host="${node0}" httpPort="8180" rmiPort="1199">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />    
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <sysproperty key="jboss.service.binding.set" value="ports-01" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
         <sysproperty key="jgroups.bind_addr" value="${node0.jgroups.bind_addr}" />
      </server>
      <server name="binding-manager2" host="${node0}" httpPort="8280" rmiPort="1299">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />  
         <jvmarg value="-XX:-UseGCOverheadLimit" />  
         <sysproperty key="jboss.service.binding.set" value="ports-02" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
         <sysproperty key="jgroups.bind_addr" value="${node1.jgroups.bind_addr}" />
      </server>
      <server name="jrmp-invoker" host="${node0}">
        <jvmarg value="-Xms128m" />    
        <jvmarg value="-Xmx512m" />  
      	<jvmarg value="-XX:MaxPermSize=128m" />
        <jvmarg value="-XX:-UseGCOverheadLimit" />
        <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
        <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
      </server>
      <server name="minimal" host="${node0}" hasWebServer="false">
         <sysproperty key="jboss.vfs.forceNoReaper" value="true" />
         <sysproperty key="jboss.boot.server.log.level" value="DEBUG" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
      </server>
      <server name="deployment-service" host="${node0}">
        <jvmarg value="-Xms128m" />
        <jvmarg value="-Xmx512m" />
        <jvmarg value="-XX:-UseGCOverheadLimit" />
        <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
        <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
      </server>
      <server name="jbpm-bpel" host="${node0}">
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
      </server>
      <server name="classloader-leak" host="${node0}">
      	<jvmarg value="-Xms128m" />
      	<jvmarg value="-Xmx512m" />
      	<jvmarg value="-XX:MaxPermSize=256m" />
        <jvmarg value="-XX:-UseGCOverheadLimit" />
      	<jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
        <!-- Use -D to set ${jboss.profiler.cmdline} to "-agentlib:jbossAgent" or
             "-agentlib:jbossAgent -d64" to use JBoss Profiler to analyze heap 
             The default value is "" turning the following into a no-op -->
        <jvmarg value="${jboss.profiler.cmdline}"/>
        <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
        <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
      	<sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
        <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
      </server>
      <server name="cluster-classloader-leak-0" host="${node0}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=256m" />  
         <jvmarg value="-XX:-UseGCOverheadLimit" />      
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <!-- Use -D to set ${jboss.profiler.cmdline} to "-agentlib:jbossAgent" or
              "-agentlib:jbossAgent -d64" to use JBoss Profiler to analyze heap 
              The default value is "" turning the following into a no-op -->
         <jvmarg value="${jboss.profiler.cmdline}"/>
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
         <sysproperty key="node0.bind.address" value="${node0}" />
         <sysproperty key="node0.bind.address.url" value="${node0.url}" />
         <sysproperty key="jboss.partition.name" value="${partitionName}"/>
         <sysproperty key="jgroups.bind_addr" value="${node0.jgroups.bind_addr}" />
      </server>
    	<!-- Note that on this node we don't run JBoss Profiler -->
    	<server name="cluster-classloader-leak-1" host="${node1}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=256m" />        
         <jvmarg value="-XX:-UseGCOverheadLimit" />      
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
         <sysproperty key="node0.bind.address" value="${node0}" />
         <sysproperty key="node0.bind.address.url" value="${node0.url}" />
         <sysproperty key="jboss.partition.name" value="${partitionName}"/>
         <sysproperty key="jgroups.bind_addr" value="${node1.jgroups.bind_addr}" />
      </server>
      <server name="profileservice" host="${node0}" partition="${partitionName}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />      
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
      </server>   	
      <server name="cluster-profilesvc-0" host="${node0}" partition="${partitionName}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />        
         <jvmarg value="-XX:-UseGCOverheadLimit" />      
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
         <sysproperty key="jboss.partition.name" value="${partitionName}"/>
         <sysproperty key="jgroups.bind_addr" value="${node0.jgroups.bind_addr}" />
      </server>
      <server name="cluster-profilesvc-1" host="${node1}" partition="${partitionName}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" /> 
         <jvmarg value="-XX:-UseGCOverheadLimit" />             
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
         <sysproperty key="jboss.partition.name" value="${partitionName}"/>
         <sysproperty key="jgroups.bind_addr" value="${node1.jgroups.bind_addr}" />
      </server>
      <server name="cluster-ustxsticky-0" host="${node0}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />  
         <jvmarg value="-XX:-UseGCOverheadLimit" />            
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
         <sysproperty key="jboss.partition.name" value="${partitionName}"/>
      </server>
      <server name="cluster-ustxsticky-1" host="${node1}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />  
         <jvmarg value="-XX:-UseGCOverheadLimit" />            
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="resolve.dns" value="false" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
         <sysproperty key="jboss.partition.name" value="${partitionName}"/>
      </server>
      <server name="springdeployer" host="${node0}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />      
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
      </server>
      <server name="hornetq" host="${node0}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />      
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <jvmarg line="-Xmx512M -Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5006"/>
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
      </server>
      <server name="jbm-cluster1" host="${node0}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="jgroups.bind_addr" value="${node0.jgroups.bind_addr}" />
      </server>
       	
      <server name="jbm-cluster2" host="${node1}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />      
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <sysproperty key="jbossnode0" value="${node0}"/>
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="jgroups.bind_addr" value="${node1.jgroups.bind_addr}" />
      </server>

      <server name="web" host="${node0}" serverUrl="${node0.jndi.http.url}">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />      
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
      </server>
    	
      <server name="web-ondemand-disabled" host="${node0}">
         <jvmarg value="${jpda.cmdline}" />
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx256m" />
         <jvmarg value="-XX:MaxPermSize=512m" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
      	 <!-- Disable on-demand war deployment -->
      	 <sysproperty key="jboss.as.deployment.ondemand" value="false" />
      </server>
    	
      <server name="scripts" host="${node0}" partition="ScriptsTestPartition">
         <jvmarg value="-Xms128m" />
         <jvmarg value="-Xmx512m" />
         <jvmarg value="-XX:MaxPermSize=512m" />
         <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
         <jvmarg value="-XX:-UseGCOverheadLimit" />
         <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
         <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
         <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
         <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
         <sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
      </server>
      
    </server:config>
  
    <property name="server-config.target.complete" value="true"/>
  </target>  <!-- end server-config target -->
  
    <!-- A macro for printing sleep before going into sleep
   -->
   <macrodef name="start-sleep">
      <attribute name="seconds" default="30"/>
      <sequential>
         <echo message="Will sleep for @{seconds} seconds"/>
         <sleep seconds="@{seconds}"/>
      </sequential>
   </macrodef>

   <!-- A macro for starting jboss with a given conf name and host binding
   -->
   <macrodef name="start-jboss">
      <attribute name="conf"
         description="The config name passed in as the -c option to jboss"/>
      <attribute name="host" default="${node0}"
         description="The hostname/address passed in as the -b option to jboss" />
      <attribute name="jvmargs" default="-Xmx128m"
         description="An additional jvmarg line set after any ${jpda.cmdline}"/>
      <attribute name="jboss.dist" default="${jboss.dist}"
         description="The jboss dist root directory" />
      <attribute name="java.exec" default="${java.exec}"
         description="Path to the java ececutable" />
      <sequential>
         <echo message="Will start the jboss instance @{host} with @{conf}, dist=@{jboss.dist}"/>
          <java classname="org.jboss.Main" fork="true" spawn="true" dir="@{jboss.dist}/bin" jvm="@{java.exec}">
            <classpath>
               <pathelement location="@{jboss.dist}/bin/run.jar"/>
               <pathelement location="${javac.jar}"/>
            </classpath>
            <jvmarg line="${jpda.cmdline}" />
            <jvmarg line="@{jvmargs}" />
     	    <sysproperty key="xb.builder.useUnorderedSequence" value="true" />
            <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
            <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
            <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
            <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
            <arg value="-c"/>
            <arg value="@{conf}"/>
            <arg value="-b"/>
            <arg value="@{host}"/>
         </java>
      </sequential>
   </macrodef>
   <!-- A macro for stopping jboss
   -->
   <macrodef name="stop-jboss">
      <attribute name="targethost" default="${node0}"
         description="The target host machine"/>
      <attribute name="jvmargs" default=""
         description="Addtional jvm args"/>
      <attribute name="jboss.dist" default="${jboss.dist}"
         description="The jboss dist root directory" />
      <attribute name="java.exec" default="${java.exec}"
         description="Path to the java executable" />
      <sequential>
         <echo message="Will stop the jboss instance @{targethost}"/>
         <java classname="org.jboss.Shutdown" fork="true" dir="@{jboss.dist}/bin"
	       jvmargs="@{jvmargs}" jvm="@{java.exec}">
            <classpath>
               <pathelement location="@{jboss.dist}/bin/shutdown.jar"/>
               <pathelement location="@{jboss.dist}/client/jbossall-client.jar"/>
	       <!-- JBAS-7132 -->
               <pathelement location="@{jboss.dist}/lib/jboss-bootstrap-spi-as.jar"/>
               <pathelement location="@{jboss.dist}/lib/jboss-bootstrap-spi.jar"/>
               <pathelement location="@{jboss.dist}/lib/jboss-bootstrap-spi-mc.jar"/>
               <pathelement location="@{jboss.dist}/lib/jboss-kernel.jar"/>
               <pathelement location="@{jboss.dist}/lib/jboss-system.jar"/>
               <pathelement location="@{jboss.dist}/lib/jboss-system-jmx.jar"/>
            </classpath>
            <arg value="-v"/>
            <arg value="--host"/>
            <arg value="@{targethost}"/>
            <arg value="--shutdown"/>
         </java>
      </sequential>
   </macrodef>

    <!-- A macro for starting/stopping Apache required for httpsessionreplication tests
   -->
   <macrodef name="apache">
      <attribute name="location" default="/usr/local/apache"/>
       <attribute name="action-type" default="start"/>
      <sequential>
         <echo message="Will @{action-type} the apache instance at @{location}"/>
         <echo message="If you need apache to run on port 80, then"/>
         <echo message="you need to start apache with admin/root rights."/>
         <echo message="If so, start/stop apache independent of this testsuite"/>
         <exec executable="@{location}/bin/apachectl"
               failonerror="false" failifexecutionfails="false">
             <arg value="@{action-type}"/>
         </exec>
      </sequential>
   </macrodef>


   <!-- A macro for creating a test cluster config -->
   <macrodef name="create-cluster-node"
      description="Create a simplified cluster configuration">
      <attribute name="conf"/>
   	<sequential>
         <delete dir="${jboss.dist}/server/@{conf}" failonerror="false"/>
         <echo message="creating @{conf} config, jboss.dist=${jboss.dist}"/>
         <copy todir="${jboss.dist}/server/@{conf}">
            <fileset dir="${jboss.dist}/server/all">
               <include name="conf/**"/>
               <include name="deployers/**"/>
               <include name="deploy/**"/>
               <include name="deploy-hasingleton/**"/>
               <include name="farm/**"/>
               <include name="lib/**"/>
            </fileset>
        </copy>
        <echo message="Overwriting config descriptors" />
        <copy todir="${jboss.dist}/server/@{conf}" overwrite="true" failonerror="false">
            <fileset dir="${build.resources}/test-configs/@{conf}" />
        </copy>
      </sequential>
   </macrodef>
   
	<macrodef name="create-bootstrapdependencies-config"
		description="Create a configuration based on the 'all' profile with bootstrap dependencies test's SAR">
		<attribute name="conf" />
		<attribute name="baseconf" />
		<element name="module-patternset" />
		<sequential>
			<server:config>
				<server name="@{conf}" host="${node0}">
					<jvmarg value="-Xms128m" />
					<jvmarg value="-Xmx512m" />
					<jvmarg value="-XX:MaxPermSize=512m" />
					<jvmarg value="-XX:-UseGCOverheadLimit" />
					<jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
			        <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
			        <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
					<sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed" />
                     <sysproperty key="logging.configuration" value="file:${jboss.dist}/bin/logging.properties" />
					<sysproperty key="jgroups.udp.ip_ttl" value="${jbosstest.udp.ip_ttl}" />
				</server>
			</server:config>
			<delete dir="${jboss.dist}/server/@{conf}" />
			<create-config baseconf="@{baseconf}" newconf="@{conf}"
				newconf-src="bootstrap-dependencies">
				<patternset>
					<include name="conf/**" />
					<include name="deployers/**" />
					<include name="deploy/**" />
					<include name="lib/**" />
				</patternset>
			</create-config>
			<copy
				todir="${jboss.dist}/server/@{conf}/deploy/Aaabootstrapdependencies-jbas5349.sar"
				filtering="false">
				<fileset dir="${build.lib}">
					<patternset>
					    <module-patternset />
					</patternset>
				</fileset>
			</copy>
		</sequential>
	</macrodef>

   <macrodef name="create-profileservice-config"
      description="Create a configuration with the full features profile service">
      <attribute name="conf"/>
   	  <attribute name="baseconf"/>
      <sequential>
         <delete dir="${jboss.dist}/server/@{conf}" failonerror="false"/>
         <echo message="creating @{conf} config, jboss.dist=${jboss.dist}"/>
         <copy todir="${jboss.dist}/server/@{conf}">
            <fileset dir="${jboss.dist}/server/@{baseconf}">
            <include name="conf/**"/>
            <include name="lib/**"/>
            <include name="deploy/**"/>
            <include name="deployers/**"/>
         </fileset>         	
         </copy>
         <!-- Overwrite any config content with that from the
         resources/test-configs/@{conf}
         -->
         <echo message="Overwriting config descriptors" />
         <copy todir="${jboss.dist}/server/@{conf}" overwrite="true" failonerror="false">
            <fileset dir="${build.resources}/test-configs/@{conf}" />
         </copy>
      </sequential>
   </macrodef>
	
   <macrodef name="create-springdeployer-config"
      description="Create a configuration with the springdeployer">
      <attribute name="conf"/>
   	<attribute name="baseconf"/>
      <sequential>
         <delete dir="${jboss.dist}/server/@{conf}" failonerror="false"/>
         <echo message="creating @{conf} config, jboss.dist=${jboss.dist}"/>
         <copy todir="${jboss.dist}/server/@{conf}">
         <fileset dir="${jboss.dist}/server/@{baseconf}">
            <include name="conf/**"/>
            <include name="lib/**"/>
            <include name="deploy/**"/>
            <include name="deployers/**"/>
         </fileset>
         </copy>

         <unzip  dest="${jboss.dist}/server/@{conf}/deployers" overwrite="true">
           <fileset refid="org.jboss.snowdrop:jboss-spring-deployer:zip"/>
         </unzip>

         <!-- Overwrite any config content with that from the
         resources/test-configs/@{conf}
         -->
         <echo message="Overwriting config descriptors" />
         <copy todir="${jboss.dist}/server/@{conf}" overwrite="true" failonerror="false">
            <fileset dir="${build.resources}/test-configs/@{conf}" />
         </copy>
      </sequential>
   </macrodef>
	
   <!-- A macro for creating a clustered sso config -->
   <macrodef name="create-cluster-sso-node"
	      description="Create a simplified clustered-sso configuration">
	   <attribute name="newconf"/>
   	<sequential>
	    <create-config baseconf="all" newconf="@{newconf}"
	      newconf-src="tomcat-sso-cluster">
	      <patternset>
            <include name="conf/**"/>
            <include name="deploy/**"/>
            <include name="deployers/**"/>            
            <include name="deploy-hasingleton/**"/>
            <include name="farm/**"/>
            <include name="lib/**"/>
	      </patternset>
	    </create-config>
    </sequential>
   </macrodef>
   
   <!-- A macro for creating a user transaction sticky config -->
   <macrodef name="create-ustxsticky-config"
        description="Create a simplified clustered-ustxsticky configuration">
     <attribute name="newconf"/>
     <sequential>
       <create-config baseconf="all" newconf="@{newconf}"
        newconf-src="ustxsticky">
         <patternset>
            <include name="conf/**"/>
            <include name="deploy/**"/>
            <include name="deployers/**"/>            
            <include name="deploy-hasingleton/**"/>
            <include name="farm/**"/>
            <include name="lib/**"/>
         </patternset>
       </create-config>
     </sequential>
   </macrodef> 

   <!-- This macro makes a new config whose name is given by the newconf
   attribute by copying the config given by the baseconf. The content that
   is copied from baseconf is limited to the patternset nested element. In
   addition, any content under ${build.resources}/test-configs/@{newconf}
   is also copied.
   -->
   <macrodef name="create-config"
      description="Create new config based on an existing config">
      <attribute name="baseconf" description="The base config to start with" default="default"/>
      <attribute name="newconf" description="The name of the new config"/>
      <attribute name="newconf-src" description="The name of the tests-config to copy or the baseconf" default="@{newconf}"/>
      <attribute name="jboss.dist" default="${jboss.dist}"
         description="The jboss dist root directory" />
      <element name="patternset" />
      <sequential>
         <echo message="creating @{newconf} config"/>
         <copy todir="@{jboss.dist}/server/@{newconf}" filtering="false">
            <fileset dir="@{jboss.dist}/server/@{baseconf}">
               <patternset />
            </fileset>
         </copy>
         <!-- Overwrite any config content with that from the
         resources/test-configs/@{newconf}
         -->
         <echo message="Overwriting config descriptors" />
         <copy todir="@{jboss.dist}/server/@{newconf}" overwrite="true" failonerror="false">
            <fileset dir="${build.resources}/test-configs/@{newconf-src}" />
         </copy>
      </sequential>
   </macrodef>

   <!-- A macro for setting up a node ready for http clustering config change -->
   <macrodef name="http-cluster-node-config-change">
      <attribute name="conf"/>
      <sequential>
         <!-- Added jvmRoute in server.xml -->
      	 <echo message="Giving a name to the Tomcat instance under ${jboss.dist}/server/@{conf}"/>
      	 <replace file="${jboss.dist}/server/@{conf}/deploy/jbossweb.sar/server.xml"
           token="jvmRoute=&quot;@{conf}&quot;" value=""/>
          <replace file="${jboss.dist}/server/@{conf}/deploy/jbossweb.sar/server.xml"
            token="defaultHost" value="jvmRoute=&quot;@{conf}&quot; defaultHost"/>
          <!-- Turn on UseJK in war-deployers-jboss-beans.xml -->
          <replace file="${jboss.dist}/server/@{conf}/deployers/jbossweb.deployer/META-INF/war-deployers-jboss-beans.xml"
            token="&quot;useJK&quot;&gt;false&lt;" value="&quot;useJK&quot;&gt;true&lt;"/>
      </sequential>
   </macrodef>

   <!-- A macro to execute a junit task. macro attributes:

   junit.patternset : require patternset id that identifies the junit test
      classes to run
   junit.configuration : option name used to unique a unit test that is
      run more than once. The junit.configuration value is appended to the
      test name as (@{junit.configuration}) while the output file extension is
      -@{junit.configuration}.xml.
   junit.syspropertyset : optional propertyset id that will be passed as
      system properties to the junit jvm.
   -->
   <macrodef name="run-junit"
      description="Run a batch of junit on the given patternset">
      <attribute name="junit.patternset"
         description="The patternset used to select the tests to run" />
      <attribute name="junit.configuration" default=""
         description="An optional configuration name added to the test and extention" />
      <attribute name="junit.syspropertyset" default="jbosstest-props"
         description="An optional propertyset id that will be passed as system properties" />

      <sequential>
         <!-- Set the report extension based on the -->
         <condition property="report.ext" value=".xml" >
            <equals arg1="" arg2="@{junit.configuration}" />
         </condition>
         <condition property="report.ext" value="-@{junit.configuration}.xml" >
            <not>
               <equals arg1="" arg2="@{junit.configuration}" />
            </not>
         </condition>
         <mkdir dir="${build.reports}"/>
         <mkdir dir="${build.testlog}"/>
         <echo message="Starting patternset=@{junit.patternset} config=@{junit.configuration}" />
         <junit dir="${module.output}"
            printsummary="${junit.printsummary}"
            haltonerror="${junit.haltonerror}"
            haltonfailure="${junit.haltonfailure}"
            fork="${junit.fork}"
            timeout="${junit.timeout}"
            jvm="${junit.jvm}">

            <jvmarg line="${junit.jvm.options}"/>
            
            <!-- JBAS-6125 - Seam deployment tests need more memory -->
            <!-- How can we pass this paramater from tests-profileservice only? -->
            <jvmarg value="-Xmx256m"/>
            
            <sysproperty key="jbosstest.deploy.dir" file="${build.lib}"/>
            <sysproperty key="build.testlog" value="${build.testlog}"/>
            <sysproperty key="log4j.configuration" value="file:${build.resources}/log4j.xml"/>
            <sysproperty key="jboss-junit-configuration" value="@{junit.configuration}"/>
            <sysproperty key="java.naming.provider.url" value="${node0.jndi.url}"/>
            <sysproperty key="jbosstest.server.host" value="${node0}"/>
            <sysproperty key="java.net.preferIPv4Stack" value="${java.net.preferIPv4Stack}" />
            <sysproperty key="java.net.preferIPv6Addresses" value="${java.net.preferIPv6Addresses}" />
            <sysproperty key="java.endorsed.dirs" value="${jboss.dist}/lib/endorsed"/>
            <syspropertyset>
               <propertyref prefix="jbosstest"/>
            </syspropertyset>

            <syspropertyset>
               <propertyset refid="@{junit.syspropertyset}" />
            </syspropertyset>

            <classpath>
               <pathelement location="${build.classes}"/>
               <pathelement location="${build.resources}"/>
               <!-- This may need to be externalized -->
               <pathelement location="${build.resources}/security"/>
               <path refid="tests.classpath"/>
            </classpath>

            <formatter classname="org.jboss.ant.taskdefs.XMLJUnitMultipleResultFormatter"
               usefile="${junit.formatter.usefile}"
               extension="${report.ext}"/>

            <batchtest todir="${build.reports}"
               haltonerror="${junit.batchtest.haltonerror}"
               haltonfailure="${junit.batchtest.haltonfailure}"
               fork="${junit.batchtest.fork}">

               <fileset dir="${build.classes}">
                  <patternset refid="@{junit.patternset}"/>
               </fileset>
            </batchtest>
         </junit>
      </sequential>
   </macrodef>

   <target name="create-cluster-config">
      <create-cluster-node conf="node1"/>
      <create-cluster-node conf="node2"/>
   </target>

   <target name="help">
      <echo message="The project fragment which defines the jboss server configs"/>
   </target>
   <target name="test-run-junit">
      <patternset id="util.includes">
         <include name="org/jboss/test/util/test/StringsUnitTestCase.class"/>
      </patternset>
      <run-junit junit.patternset="util.includes" junit.configuration="" />
   </target>
</project>
